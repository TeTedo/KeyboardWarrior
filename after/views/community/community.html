<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
        <script
            src="https://kit.fontawesome.com/3264d39625.js"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://code.jquery.com/jquery-3.6.0.min.js"
            integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
            crossorigin="anonymous"
        ></script>
    </head>
    <link rel="stylesheet" href="style.css" />
    <body>
        <div id="mainPageTop">
            <div id="mainLogo"><a href="/">이건 메인로고</a></div>
            <ul id="mainPageNav">
                <li><a href="/community_hub">COMMUNITY</a></li>
                <li><a href="/minigame">MINI GAME</a></li>
            </ul>

            <ul id="mainPageLogo">
                <li>
                    <a href="https://github.com/TeTedo/KeyboardWarrior.git"
                        ><img
                            class="mainPageLogo_githubLogo"
                            src="http://rajlab.org/icons/github_white.png"
                            alt="github"
                    /></a>
                </li>
                <li>
                    <a
                        href="https://www.notion.so/Keyboard-Warrior-888a144aa79f437e8f726910c42617a8"
                        ><img
                            class="mainPageLogo_notionLogo"
                            src="https://upload.wikimedia.org/wikipedia/commons/4/45/Notion_app_logo.png"
                            alt="notion"
                    /></a>
                </li>
            </ul>
        </div>

        <!-- <div id="mainPageSearch">
      <div id="mainPageSearch_whole">
        <input type="text" id="mainPageSearch_searchBar" />
        <span>검색</span>
      </div>
    </div> -->
        <!-- 여기까지 탑 공통 부분 -->

        <!-- 사이드바 -->
        <div id="sideBar">
            <div id="sideBar_top">
                <div id="sideBar_top_up">
                    <ul>
                        <li>팔로워</li>
                        <li>123</li>
                    </ul>
                    <ul>
                        <li>팔로잉</li>
                        <li>111</li>
                    </ul>
                </div>
                <div id="sideBar_top_down">
                    <div id="sideBar_top_down_left">
                        <div><%= data.userIdForProfile %></div>
                        <div><%= data.nickNameForProfile %></div>
                    </div>
                    <div id="sideBar_top_down_right">
                        <div>
                            <a href=""><i class="fa-solid fa-bell"></i></a>
                            <a href=""><i class="fa-solid fa-comments"></i></a>
                            <a href="/logout"
                                ><i class="fa-solid fa-right-from-bracket"></i
                            ></a>
                        </div>
                        <a href="/posting">글쓰기</a>
                    </div>
                </div>
                <div id="sideBar_top_profileImg"></div>
            </div>
        </div>

        <!-- 포스팅 시작 -->
        <div id="communityTitle">
            <div id="communityTitle_text">
                <span><%= data.title %></span>
            </div>
        </div>
        <div id="contents">
            <div id="contentsWrap">
                <div id="mainContent">
                    <div id="mainContentWrap">
                        <div class="mainPost">
                            <div id="mainPost_top">
                                <div id="mainPost_top_profileimg">
                                    <img
                                        src="../images/profileimg.jpg"
                                        alt=""
                                    />
                                </div>
                                <ul id="mainPost_top_button">
                                    <li>
                                        <i class="fa-solid fa-heart"></i
                                        ><i
                                            class="fa-solid fa-heart-circle-check"
                                        ></i>
                                    </li>
                                    <li>
                                        <i class="fa-solid fa-share-nodes"></i>
                                    </li>
                                </ul>
                            </div>
                            <div id="mainPost_middle">
                                <div id="mainPost_middle_img">
                                    <img src="../images/Example.jpeg" alt="" />
                                </div>
                                <div id="mainPost_middle_text"></div>
                            </div>
                            <ul id="mainPost_bottom">
                                <li id="mainPost_bottom_recomment">
                                    <span>아이디</span>
                                    <span>여기서부터 댓글</span>
                                </li>
                            </ul>
                        </div>

                        <!-- 포스팅 1개끝 -->
                        <% data.postData.forEach(post=>{%>
                        <div class="mainPost">
                            <div id="mainPost_top"></div>
                            <div
                                id="mainPost_middle"
                                data-post_id="<%= post.id%>"
                            >
                                <%=post.text%>
                            </div>
                            <div id="mainPost_bottom">
                                <% post.hashtag_values.forEach(hashtag=>{%>
                                <span class="hashTag"> <%=hashtag%> </span>
                                <%})%>
                            </div>
                        </div>
                        <%})%>
                    </div>
                </div>
                <!-- 여기까지 메인포스팅 슬라이드 -->
                <div id="scrollHelper">
                    <div id="scrollHelper_contents">
                        <div id="scrollHelper_icon">➡️</div>
                        <div id="scrollHelper_text">SCROLL UP!</div>
                    </div>
                </div>
            </div>
        </div>
        <button id="btn">글쓰기</button>
    </body>
    <script>
        window.onload = () => {
            // scroll evnet
            let scrollx = 0;
            // 가로로 스크롤 이동
            contentsWrap.onwheel = function (e) {
                window.onwheel = null;
                const contentsWrap = document.querySelector("#contentsWrap");
                const mainContent = document.querySelector("#mainContent");
                const mainContentWrap =
                    document.querySelector("#mainContentWrap");

                const maxScroll =
                    mainContentWrap.offsetWidth - mainContent.offsetWidth;
                scrollx =
                    scrollx < 0 ? 0 : scrollx > maxScroll ? maxScroll : scrollx;
                //아래로 스크롤인 경우
                if (e.deltaY > 0) {
                    scrollx += 30;
                }
                //위로 스크롤인경우
                else {
                    scrollx -= 30;
                }
                offAnimation();
                mainContent.scrollTo(scrollx, 0);
            };

            // 포스트 클릭시 상세페이지 이동
            const gameName = "<%= data.gameName %>";
            btn.onclick = () => {
                location.href = `/posting/${gameName}`;
            };

            const mainPost = document.querySelectorAll("#mainPost_middle");
            mainPost.forEach(post => {
                const postId = post.dataset.post_id;
                post.onclick = () => {
                    location.href = `/post/${gameName}/${postId}`;
                };
            });

            // 스크롤헬퍼 이벤트 (스크롤대상 돔 contentsWrap으로 바꿔주기)
            const scrollHelper = document.querySelector("#scrollHelper");
            const scrollHelperText =
                document.querySelector("#scrollHelper_text");
            const scrollHelperIcon =
                document.querySelector("#scrollHelper_icon");
            const body = document.querySelector("body");
            function offAnimation() {
                scrollHelper.classList.remove("active");
                scrollHelperText.classList.remove("active");
                scrollHelperIcon.classList.remove("active");
            } // 이거 스크롤기능에도 넣어줘야함(스크롤하면 꺼지게)
            contentsWrap.onmouseenter = () => {
                body.classList.add("block"); // 작은화면에서 슬라이드할때 윈도우 스크롤 막기용
                scrollHelper.classList.add("active");
                scrollHelperText.classList.add("active");
                scrollHelperIcon.classList.add("active");
            };
            contentsWrap.onmouseleave = () => {
                body.classList.remove("block");
                offAnimation();
            };
            contentsWrap.onclick = () => offAnimation();
        };
    </script>
    <script>
        const arr = ["happy", "hi"];
        const jsonArr = JSON.stringify(arr);
        const stringArr = '["happy", "hi"]';

        console.log(JSON.parse(jsonArr));
        console.log(JSON.parse(stringArr));
    </script>
</html>
